<app-loader *ngIf="(loading$ | async) && !(error$ | async)"></app-loader>

<div class="actions" [formGroup]="form">
  <mat-form-field>
    <mat-label>Search Food</mat-label>
    <input matInput formControlName="foodName" />
  </mat-form-field>

  <mat-form-field>
  <mat-label>SearchByTags</mat-label>
  <mat-select formControlName="tags" multiple *ngIf="(tags$ | async) as tags">
    <mat-option *ngFor="let tag of tags" [value]="tag.id">{{ tag.name }}</mat-option>
  </mat-select>
</mat-form-field>

  <div class="actions__btn">
    <button
      mat-flat-button
      [disabled]="loading$ | async"
      color="primary"
      (click)="addFood()"
    >
      Add Food <mat-icon class="icon">add_circle_outline</mat-icon>
    </button>
  </div>
</div>


<mat-card>
  <table
    class="mat-elevation-z8"
    mat-table
    matSort
    class="table"
    [dataSource]="dataSource"
  >
    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
      <td mat-cell *matCellDef="let row">{{ row.name }}</td>
    </ng-container>

    <ng-container matColumnDef="weight">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Weight</th>
      <td mat-cell *matCellDef="let row">{{ row.weight }}g</td>
    </ng-container>

    <ng-container matColumnDef="caloriesPer100g">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Calories per 100 g</th>
      <td mat-cell *matCellDef="let row">{{ row.caloriesPer100g }}kcal</td>
    </ng-container>

    <ng-container matColumnDef="nutriScore">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Nutri score</th>
      <td mat-cell *matCellDef="let row">
        <app-nutri-score [nutriScore]="row.nutriScore"></app-nutri-score>
      </td>
    </ng-container>

    <ng-container matColumnDef="tags">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Tags</th>
      <td mat-cell *matCellDef="let row">
        {{ row.tags }}
      </td>
    </ng-container>

    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Actions</th>
      <td mat-cell *matCellDef="let row">
        <button
          mat-icon-button
          color="primary"
          (click)="editFood(row.id); $event.stopPropagation()"
          aria-label="Edit food"
        >
          <mat-icon>edit</mat-icon>
        </button>
        <button
          mat-icon-button
          color="warn"
          (click)="deleteFood(row.id); $event.stopPropagation()"
          aria-label="Delete food"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </td>
    </ng-container>

    <tr class="mat-row" *matNoDataRow>
      <td class="mat-cell" [attr.colspan]="displayedColumns.length">
        No foods to display
      </td>
    </tr>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr
      mat-row
      *matRowDef="let row; columns: displayedColumns"
      (click)="showFoodDetails(row)"
    ></tr>
  </table>

  <mat-paginator
    showFirstLastButtons
    [pageSize]="5"
    [pageSizeOptions]="[5, 10]"
    aria-label="Select page of foods"
  ></mat-paginator>
</mat-card>
